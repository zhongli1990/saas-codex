# v0.2.0 Implementation Status and Future Roadmap

This document provides a comprehensive status report of v0.2.0 implementation, pending refinements, and the roadmap for future releases targeting NHS Trust non-technical clinical users.

---

## Table of Contents

1. [Current Implementation Status](#1-current-implementation-status)
2. [What Is Implemented and How](#2-what-is-implemented-and-how)
3. [Pending Refinements and Uplift Opportunities](#3-pending-refinements-and-uplift-opportunities)
4. [v0.3.0 Roadmap: NHS Trust Clinical User Self-Service](#4-v030-roadmap-nhs-trust-clinical-user-self-service)
5. [v0.4.0+ Vision: Full Release Lifecycle Automation](#5-v040-vision-full-release-lifecycle-automation)
6. [Next Actions](#6-next-actions)

---

## 1. Current Implementation Status

### Branch: `dev/v0.2.0`

### Commits (8 total)

| # | Commit | Description |
|---|--------|-------------|
| 1 | `347ffd7` | Design docs, SSE hardening, Dockerfile fix |
| 2 | `d5fb7e5` | Claude runner microservice (Python/FastAPI) |
| 3 | `4c0291d` | UI uplift: runner selection, transcript view |
| 4 | `99ff020` | E2E test for SSE streaming |
| 5 | `7566e30` | Implementation plan update |
| 6 | `b0eb7cd` | Persistence schema and workspace/session management |
| 7 | `e754774` | Microservices placeholders |
| 8 | `0b80717` | README update |

### Feature Completion Matrix

| Feature | Status | Notes |
|---------|--------|-------|
| Claude Runner | ✅ Complete | Agent loop with tool use |
| Codex Runner | ✅ Complete | SSE hardening applied |
| Multi-Runner UI | ✅ Complete | Dropdown selection |
| Transcript View | ✅ Complete | Markdown rendering |
| Raw Events View | ✅ Complete | JSON display |
| Tool Call Display | ✅ Complete | Collapsible sections |
| Workspace Import | ✅ Complete | GitHub + local path |
| Workspace Registry | ✅ Complete | De-duplication by source |
| Session Management | ✅ Complete | List, create, continue |
| SSE Streaming | ✅ Complete | Anti-buffering, replay |
| Persistence Schema | ✅ Complete | SQLAlchemy + Alembic |
| Prompt Manager | ✅ Placeholder | CRUD + render |
| Evaluation Service | ✅ Placeholder | Score endpoint |
| Memory Service | ✅ Placeholder | Store + query |
| LLM Gateway | ✅ Placeholder | Unified API |
| Database Integration | ⚠️ Partial | Schema ready, queries in-memory |
| Authentication | ❌ Not Started | Planned for v0.3.0 |
| Tenant Isolation | ❌ Not Started | Schema has tenant_id fields |

---

## 2. What Is Implemented and How

### 2.1 Claude Runner (`claude-runner/`)

**Implementation Approach**:
- Python 3.12 + FastAPI for ecosystem alignment
- Anthropic SDK for Claude API access
- Custom agent loop with tool use (not SDK agent)
- Same HTTP contract as Codex runner for backend compatibility

**Agent Loop**:
1. Receive user prompt
2. Send to Claude with tool definitions
3. Stream response chunks via SSE
4. If Claude requests tool call → execute tool → continue
5. Repeat until final response
6. Emit `run.completed` event

**Tools Implemented**:
- `read_file` - Read file contents with path validation
- `write_file` - Write content with directory creation
- `list_files` - List directory entries
- `bash` - Execute shell commands with timeout

**Security**:
- All paths validated under `WORKSPACES_ROOT`
- Bash commands run in working directory only
- 60-second timeout on bash execution

### 2.2 UI Uplift (`frontend/src/app/(app)/codex/page.tsx`)

**Implementation Approach**:
- React state management for workspace/session/run flow
- `react-markdown` + `remark-gfm` for Markdown rendering
- EventSource for SSE consumption
- Transcript derived from normalized UI events

**State Flow**:
```
idle → creating-session → session-ready → running → completed/error
```

**Event Processing**:
- `ui.message.user` → User message bubble
- `ui.message.assistant.delta` → Accumulate text
- `ui.message.assistant.final` → Assistant message bubble
- `ui.tool.call` → Tool call section (collapsible)
- `ui.tool.result` → Tool result section (collapsible)

### 2.3 Backend Routing (`backend/app/main.py`)

**Implementation Approach**:
- `runner_type` stored per session
- `_get_runner_url()` routes to correct runner
- `_runs` dict tracks run → runner_type for SSE routing

**Workspace De-duplication**:
- `_find_workspace_by_source(source_type, source_uri)`
- Returns existing workspace if found
- Prevents duplicate clones

### 2.4 Persistence Schema (`backend/app/models.py`)

**Implementation Approach**:
- SQLAlchemy 2.0 async ORM
- Alembic for migrations
- PostgreSQL-specific types (UUID, JSONB, TIMESTAMPTZ)

**Current State**:
- Schema defined and migration ready
- Backend uses in-memory dicts for MVP speed
- Migration to actual queries is straightforward

### 2.5 Microservices (Placeholders)

**Implementation Approach**:
- Minimal FastAPI services with stable APIs
- In-memory storage for MVP
- Ready for production implementation

**Purpose**:
- Establish API contracts early
- Enable frontend/backend integration
- Defer complex implementation to later phases

---

## 3. Pending Refinements and Uplift Opportunities

### 3.1 High Priority (v0.2.1)

| Item | Description | Effort |
|------|-------------|--------|
| **Database Integration** | Replace in-memory dicts with actual Postgres queries | Medium |
| **Session Continuation** | UI to select and continue existing sessions | Low |
| **Workspace Dropdown** | UI to select from imported workspaces | Low |
| **Error Handling** | Better error messages and recovery | Medium |
| **Loading States** | Skeleton loaders and progress indicators | Low |

### 3.2 Medium Priority (v0.2.2)

| Item | Description | Effort |
|------|-------------|--------|
| **Run History** | View past runs and their transcripts | Medium |
| **Event Persistence** | Store SSE events to Postgres in real-time | Medium |
| **Transcript Replay** | Reload transcript from persisted events | Medium |
| **Copy to Clipboard** | Copy transcript messages | Low |
| **Export Transcript** | Download as Markdown/PDF | Medium |

### 3.3 Technical Debt

| Item | Description | Priority |
|------|-------------|----------|
| **Type Safety** | Add TypeScript strict mode to frontend | Medium |
| **API Validation** | Add Pydantic validation to all endpoints | Medium |
| **Logging** | Structured logging across all services | High |
| **Metrics** | Prometheus metrics for observability | Medium |
| **Rate Limiting** | Protect against abuse | Medium |

### 3.4 Microservices Uplift

| Service | Current | Target |
|---------|---------|--------|
| **Prompt Manager** | In-memory storage | Postgres + versioning |
| **Evaluation** | Placeholder scores | LangSmith integration |
| **Memory** | Simple text matching | Vector embeddings + semantic search |
| **LLM Gateway** | Stub responses | Real provider routing + caching |

---

## 4. v0.3.0 Roadmap: NHS Trust Clinical User Self-Service

### 4.1 Vision

Enable NHS Trust non-technical clinical users to:
- Use plain English to analyze TIE (Trust Integration Engine) implementations
- Perform reverse engineering and documentation without developers
- Generate requirement specifications from natural language
- Execute full release lifecycle tasks with AI assistance

### 4.2 Target Personas

| Persona | Role | Needs |
|---------|------|-------|
| **Clinical Informaticist** | Defines clinical requirements | Natural language input, no code knowledge |
| **Integration Analyst** | Analyzes existing integrations | Reverse engineering, documentation |
| **Project Manager** | Tracks progress and approvals | Status dashboards, audit trails |
| **Compliance Officer** | Ensures governance | Audit logs, policy enforcement |

### 4.3 Key Features

#### 4.3.1 Natural Language Interface

**Goal**: Users describe tasks in plain English; AI translates to agent actions.

**Implementation**:
- Pre-built prompt templates for common tasks
- Intent classification to route to appropriate workflow
- Guided wizard for complex tasks
- Clarification dialogs when intent is ambiguous

**Example Interactions**:
```
User: "Analyze the HL7v2 ADT message handling in this integration"
→ AI: Identifies relevant files, traces message flow, generates documentation

User: "What changes are needed to support the new patient identifier format?"
→ AI: Analyzes current implementation, identifies impact points, proposes changes

User: "Generate a test plan for the new discharge notification"
→ AI: Creates test cases, edge cases, expected outcomes
```

#### 4.3.2 TIE Analysis Workflows

| Workflow | Description | Output |
|----------|-------------|--------|
| **Reverse Engineering** | Analyze existing integration code | Architecture diagram, data flow, component inventory |
| **Impact Assessment** | Evaluate change requirements | Affected components, risk analysis, effort estimate |
| **Documentation Generation** | Create technical docs | API specs, message formats, integration guides |
| **Gap Analysis** | Compare current vs. required | Missing features, compliance gaps, recommendations |

#### 4.3.3 Guided Task Wizards

**Step-by-step workflows for common tasks**:

1. **New Requirement Analysis**
   - Input: Clinical requirement in plain English
   - Steps: Clarify scope → Analyze codebase → Identify changes → Generate spec
   - Output: Technical specification document

2. **Integration Documentation**
   - Input: Select integration/workspace
   - Steps: Scan codebase → Extract patterns → Generate diagrams → Create docs
   - Output: Integration documentation package

3. **Test Case Generation**
   - Input: Feature description or change request
   - Steps: Analyze requirements → Identify scenarios → Generate test cases
   - Output: Test plan with expected outcomes

#### 4.3.4 Approval Workflows

**For NHS governance requirements**:

- Draft → Review → Approve → Implement → Verify
- Role-based access control
- Audit trail for all actions
- Digital signatures for approvals

### 4.4 UI/UX Requirements

#### 4.4.1 Simplified Interface

| Current (v0.2.0) | Target (v0.3.0) |
|------------------|-----------------|
| Technical prompt input | Task selection wizard |
| Raw events view | Hidden by default |
| Manual session management | Automatic context |
| Single workspace | Project dashboard |

#### 4.4.2 Dashboard View

```
┌─────────────────────────────────────────────────────────────────┐
│  NHS Trust Integration Platform                    [User] [Help] │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ Analyze     │  │ Document    │  │ Test        │              │
│  │ Integration │  │ System      │  │ Changes     │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
│                                                                  │
│  Recent Projects                                                 │
│  ┌─────────────────────────────────────────────────────────────┐│
│  │ ADT Integration    │ Last: 2 hours ago │ [Continue]         ││
│  │ Lab Results Feed   │ Last: 1 day ago   │ [Continue]         ││
│  │ Discharge Notif.   │ Last: 3 days ago  │ [Continue]         ││
│  └─────────────────────────────────────────────────────────────┘│
│                                                                  │
│  Quick Actions                                                   │
│  • "What does this integration do?"                              │
│  • "Generate documentation for..."                               │
│  • "What changes are needed for..."                              │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

#### 4.4.3 Conversation View

```
┌─────────────────────────────────────────────────────────────────┐
│  ADT Integration Analysis                              [Export]  │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  You: Analyze the patient admission message handling            │
│                                                                  │
│  ┌─────────────────────────────────────────────────────────────┐│
│  │ Assistant:                                                   ││
│  │                                                              ││
│  │ I've analyzed the ADT^A01 message handling. Here's what     ││
│  │ I found:                                                     ││
│  │                                                              ││
│  │ ## Message Flow                                              ││
│  │ 1. Message received at `adt_receiver.py`                    ││
│  │ 2. Parsed by `hl7_parser.py`                                ││
│  │ 3. Patient record created in `patient_service.py`          ││
│  │                                                              ││
│  │ ## Key Components                                            ││
│  │ - **Receiver**: Listens on port 2575                        ││
│  │ - **Parser**: Handles HL7v2.5 format                        ││
│  │ - **Validator**: Checks required fields                     ││
│  │                                                              ││
│  │ [View Details] [Generate Documentation] [Ask Follow-up]     ││
│  └─────────────────────────────────────────────────────────────┘│
│                                                                  │
│  ┌─────────────────────────────────────────────────────────────┐│
│  │ Ask a follow-up question...                          [Send] ││
│  └─────────────────────────────────────────────────────────────┘│
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

### 4.5 Technical Requirements

| Requirement | Implementation |
|-------------|----------------|
| **Authentication** | OIDC/SAML integration with NHS Identity |
| **Authorization** | Role-based access control (RBAC) |
| **Audit Logging** | Immutable audit trail for all actions |
| **Data Classification** | PII/PHI awareness and handling |
| **Retention Policies** | Configurable data retention |
| **Encryption** | At-rest and in-transit encryption |

---

## 5. v0.4.0+ Vision: Full Release Lifecycle Automation

### 5.1 Capabilities

| Phase | AI-Assisted Tasks |
|-------|-------------------|
| **Requirements** | Capture, clarify, validate clinical requirements |
| **Analysis** | Impact assessment, gap analysis, effort estimation |
| **Design** | Architecture proposals, interface specifications |
| **Implementation** | Code generation, modification, refactoring |
| **Testing** | Test case generation, execution, validation |
| **Documentation** | Technical docs, user guides, release notes |
| **Deployment** | Deployment scripts, configuration, verification |
| **Monitoring** | Health checks, alerting, incident response |

### 5.2 Agent Collaboration

**Multi-agent workflows**:
- **Analyst Agent**: Understands requirements, analyzes code
- **Architect Agent**: Proposes designs, validates patterns
- **Developer Agent**: Implements changes, writes tests
- **Reviewer Agent**: Reviews code, checks compliance
- **Tester Agent**: Executes tests, reports results

**Orchestration**:
- Workflow engine coordinates agent handoffs
- Human-in-the-loop for approvals
- Rollback capabilities for failed steps

### 5.3 Quality Assurance

| Aspect | Mechanism |
|--------|-----------|
| **Code Quality** | Automated linting, style checks |
| **Security** | SAST/DAST scanning, vulnerability checks |
| **Compliance** | Policy enforcement, audit trails |
| **Testing** | Automated test execution, coverage tracking |
| **Documentation** | Completeness checks, consistency validation |

### 5.4 Integration Points

| System | Integration |
|--------|-------------|
| **Git** | Repository management, branching, PRs |
| **CI/CD** | Pipeline triggering, deployment |
| **Issue Tracking** | Jira, ServiceNow integration |
| **Documentation** | Confluence, SharePoint publishing |
| **Monitoring** | Prometheus, Grafana dashboards |

---

## 6. Next Actions

### Immediate (This Week)

| # | Action | Owner | Priority |
|---|--------|-------|----------|
| 1 | Test v0.2.0 with real API keys | Dev | High |
| 2 | Run database migrations | Dev | High |
| 3 | Fix any issues found in testing | Dev | High |
| 4 | Merge dev/v0.2.0 to main | Dev | Medium |
| 5 | Tag v0.2.0 release | Dev | Medium |

### Short-term (Next 2 Weeks)

| # | Action | Owner | Priority |
|---|--------|-------|----------|
| 1 | Implement database integration | Dev | High |
| 2 | Add workspace dropdown to UI | Dev | Medium |
| 3 | Add session selection to UI | Dev | Medium |
| 4 | Implement run history view | Dev | Medium |
| 5 | Add structured logging | Dev | Medium |

### Medium-term (Next Month)

| # | Action | Owner | Priority |
|---|--------|-------|----------|
| 1 | Design v0.3.0 clinical user workflows | Product | High |
| 2 | Implement authentication (OIDC) | Dev | High |
| 3 | Implement RBAC | Dev | High |
| 4 | Create task wizard UI | Dev | Medium |
| 5 | Integrate LangSmith for evaluation | Dev | Medium |

### Long-term (Next Quarter)

| # | Action | Owner | Priority |
|---|--------|-------|----------|
| 1 | NHS Trust pilot deployment | Ops | High |
| 2 | Clinical user feedback collection | Product | High |
| 3 | Multi-agent workflow engine | Dev | Medium |
| 4 | Full release lifecycle automation | Dev | Medium |
| 5 | Enterprise security hardening | Security | High |

---

## Appendix: Release Schedule

| Version | Target Date | Focus |
|---------|-------------|-------|
| v0.2.0 | Jan 2026 | Multi-runner, workspace registry, transcript UI |
| v0.2.1 | Feb 2026 | Database integration, session continuation |
| v0.2.2 | Feb 2026 | Run history, event persistence |
| v0.3.0 | Mar 2026 | Clinical user workflows, authentication |
| v0.3.1 | Apr 2026 | Task wizards, guided workflows |
| v0.4.0 | Q2 2026 | Full lifecycle automation, multi-agent |

